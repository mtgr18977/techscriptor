var editor=ace.edit("editor");function loadPopovers(){[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e,{trigger:"hover focus",html:!0})})}function getPopover(e,r,t){return'<span style="background: '+t+';" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-placement="top" data-bs-content="'+r+'">'+e+"</span>"}editor.setTheme("ace/theme/chrome"),editor.session.setMode("ace/mode/markdown"),editor.setOptions({fontSize:14,vScrollBarAlwaysVisible:!0,wrap:!0});var md=window.markdownit().use(window.markdownitFootnote);const beforeUnloadListener=e=>(e.preventDefault(),e.returnValue="Tem certeza de que deseja sair?");function getReplacementString(e){return"[#r"+e+"]"}function countWords(e){let r=e.split(" ");return r.filter(e=>""!==e).length}function countSentences(e){return null==(s=e.match(/[\w|\)][.?!](\s|$)/g))?0:s.length}function updateView(){htmlOutput=md.render(editor.getValue());var e=[];let r={hardToRead:{regex:/((\w+,\s+)|(\w+\s+)){20,}(\w+[\.|?|!])/g,message:"Esta sentença é difícil de ler.",color:"#f0f0a0",summary:" sentenças são difíceis de ler.",summarySingle:" sentença é difícil de ler."},adverbs:{regex:/((\w+)ly)|às vezes|talvez|talvez/g,message:"<em>Advérbio:</em> Use um verbo forte.",color:"#a0e0ff",summary:" advérbios.",summarySingle:" advérbio."},passiveVoice:{regex:/\b((be(en)?)|(w(as|ere))|(is)|(a(er|m)))(\.|\,)?\s(\w+\s)?(\w+(en|ed))(\s|\.|\,)/g,message:"<em>Voz passiva:</em> Use voz ativa.",color:"#a0f0a0",summary:" usos da voz passiva.",summarySingle:" uso da voz passiva."},thereIsThereAre:{regex:/\bHá (é|são)\b/g,message:"<em>Genérico:</em> Seja preciso.",color:"#f0a0f0",summary:" usos de <em>Há</em>/<em>Existem</em>.",summarySingle:" uso de <em>Há</em>/<em>Existem</em>."},genericVerb:{regex:/\b(acontecer|ocorrer)(s?)/g,message:"<em>Verbo genérico:</em> Use verbos precisos.",color:"#f0a0f0",summary:" usos de verbos genéricos.",summarySingle:" uso de verbos genéricos."}};var t={};for(var n in r)rule=r[n],t[n]=0,htmlOutput=htmlOutput.replaceAll(rule.regex,function(r){return e.push(getPopover(r,rule.message,rule.color)),t[n]++,getReplacementString(e.length-1)});for(var n in console.log(t),rulesSummary="",r){var a=r[n].summary;1==t[n]&&(a=r[n].summarySingle),rulesSummary+='<div class="rounded m-1 p-1 d-inline-block" style="background: '+r[n].color+';"><span class="badge bg-secondary">'+t[n]+"</span>"+a+"</div>"}document.getElementById("mdviewSummary").innerHTML=rulesSummary;for(let o=0;o<e.length;o++)htmlOutput=htmlOutput.replace(getReplacementString(o),e[o]);htmlOutput=(htmlOutput=htmlOutput.replaceAll("<blockquote>",'<blockquote class="blockquote">')).replaceAll("<table>",'<table class="table table-bordered table-striped">'),document.getElementById("mdview").innerHTML=htmlOutput,sentences=countSentences(outputWithoutHtml=htmlOutput.replace(/(<([^>]+)>)/ig,"")),words=countWords(outputWithoutHtml),(characters=outputWithoutHtml.length-1)<0&&(characters=0),warnings=e.length,document.getElementById("sentences").innerHTML=sentences,document.getElementById("words").innerHTML=words,document.getElementById("characters").innerHTML=characters,document.getElementById("warnings").innerHTML=warnings,warningsClass="text-success",warnings/words>.03&&(warningsClass="text-warning"),warnings/words>.05&&(warningsClass="text-danger"),document.getElementById("warnings").className=warningsClass,loadPopovers(),hljs.highlightAll(),addEventListener("beforeunload",beforeUnloadListener,{capture:!0})}updateView(),editor.session.on("change",function(e){updateView()});
