var editor=ace.edit("editor");editor.setTheme("ace/theme/chrome");editor.session.setMode("ace/mode/markdown");editor.setOptions({fontSize:14,vScrollBarAlwaysVisible:true,wrap:true});function loadPopovers(){var e=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e,{trigger:"hover focus",html:true})})}function getPopover(e,t,o){return`<span style="background: ${o};" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-placement="top" data-bs-content="${t}">${e}</span>`}var md=window.markdownit().use(window.markdownitFootnote);const beforeUnloadListener=e=>{e.preventDefault();return e.returnValue="Are you sure you want to exit?"};function getReplacementString(e){return"[#r"+e+"]"}function countWords(e){return e.split(' ').filter(e=>""!==e).length}function countSentences(e){return null==(e=e.match(/[\w|\)][.?!](\s|$)/g))?0:e.length}function updateView(){htmlOutput=md.render(editor.getValue());var e=[],t={passiveVoice:{regex:/\b((é|foi)|(são|eram)|(está|estava)|(seria|será)|(ser|estar))(\.|\,)?\s(\w+\s)?(\w+(ido|ado))(\s|\.|\,)/g,message:"<em>Voz passiva:</em> Use a voz ativa.",color:"#a0f0a0",summary:" utilizações da voz passiva.",summarySingle:" utilização da voz passiva."},thereIsThereAre:{regex:/\bTem (um|uma|alguns|algumas)\b/g,message:"<em>Genérico:</em> Seja preciso.",color:"#f0a0f0",summary:" utilizações de <em>Tem</em>.",summarySingle:" utilização de <em>Tem</em>."},genericVerb:{regex:/\b(acontece|muito|muita|ocorre|ocorrem)(s?)/g,message:"<em>Verbo genérico:</em> Use verbos mais precisos.",color:"#f0a0f0",summary:" utilizações de verbos genéricos.",summarySingle:" utilização de verbos genéricos."},tooManyWords:{regex:/(\w+\s){50,}/g,message:"Esta frase tem muitas palavras. Considere dividir em frases menores.",color:"#f0f0a0",summary:" frases têm muitas palavras.",summarySingle:" frase tem muitas palavras."},repeatedWords:{regex:/\b(\w+)\s+\1\b/g,message:"Evite repetir a mesma palavra consecutivamente.",color:"#f0f0a0",summary:" repetições de palavras.",summarySingle:" repetição de palavras."},cliches:{regex:/\b(às vezes|de vez em quando|em um piscar de olhos)\b/g,message:"Evite clichês e expressões muito comuns.",color:"#f0f0a0",summary:" clichês ou expressões comuns.",summarySingle:" clichê ou expressão comum."}},o={};for(var r in t){var n=t[r];o[r]=0,htmlOutput=htmlOutput.replaceAll(n.regex,function(t){return e.push(getPopover(t,n.message,n.color)),o[r]++,getReplacementString(e.length-1)})}console.log(o),rulesSummary="";for(var r in t){var s=t[r].summary;1==o[r]&&(s=t[r].summarySingle),rulesSummary+=`<div class="rounded m-1 p-1 d-inline-block" style="background: ${t[r].color};"><span class="badge bg-secondary"> ${o[r]}</span>" ${s}  </div>`}document.getElementById('mdviewSummary').innerHTML=rulesSummary;for(let t=0;t<e.length;t++)htmlOutput=htmlOutput.replace(getReplacementString(t),e[t]);htmlOutput=htmlOutput.replaceAll("<blockquote>",'<blockquote class="blockquote">'),htmlOutput=htmlOutput.replaceAll("<table>",'<table class="table table-bordered table-striped">'),document.getElementById('mdview').innerHTML=htmlOutput,outputWithoutHtml=htmlOutput.replace(/(<([^>]+)>)/gi,""),sentences=countSentences(outputWithoutHtml),words=countWords(outputWithoutHtml),characters=outputWithoutHtml.length-1,characters<0&&(characters=0),warnings=e.length,document.getElementById('sentences').innerHTML=sentences,document.getElementById('words').innerHTML=words,document.getElementById('characters').innerHTML=characters,document.getElementById('warnings').innerHTML=warnings,warningsClass="text-success",warnings/words>0.03&&(warningsClass="text-warning"),warnings/words>0.05&&(warningsClass="text-danger"),document.getElementById('warnings').className=warningsClass,loadPopovers(),hljs.highlightAll(),addEventListener("beforeunload",beforeUnloadListener,{capture:true})}updateView(),editor.session.on('change',function(e){updateView()});
